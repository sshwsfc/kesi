### **KESI智能软件系统设计说明书大纲**

#### **第一部分：系统总览**

1.  **1.1 项目愿景与目标**
    *   **愿景**：构建一个“感、联、智、用”一体化的智慧运营中枢，实现物理世界的全面数字化、智能化。
    *   **目标**：通过五大中台，降低系统集成复杂度，提升数据价值，赋能上层业务快速创新，支撑规模化、可复制的解决方案。

2.  **1.2 核心设计原则**
    *   **中台化、微服务架构**：五大中台独立部署、独立升级，通过标准API交互。
    *   **高内聚、低耦合**：每个中台功能内聚，中台间依赖明确、接口标准化。
    *   **数据驱动**：以数据流贯穿物联感知、业务处理、AI分析、可视化呈现全流程。
    *   **可扩展性与开放性**：支持功能模块、设备协议、AI算法、可视化组件的“热插拔”。

3.  **1.3 总体架构图（需AI生成Mermaid/PlantUML代码描述）**
    *   **展现层**：Web门户、大屏、移动端。
    *   **中台层**：五大中台（并列展示）。
    *   **基础设施层**：容器平台、数据库、消息队列、对象存储、流媒体服务、GPU算力等。
    *   **数据流**：物联数据 -> 物联中台 -> 业务/视频/AI中台 -> 可视化中台。

---

#### **第二部分：通用能力模块详细设计（所有中台共用）**

1.  **2.1 用户、角色、权限管理（统一认证授权中心）**
    *   **功能**：统一用户体系、角色定义、权限策略（基于RBAC）、单点登录、OAuth2.0/OpenID Connect支持。
    *   **接口**：提供标准的用户认证、授权校验、令牌管理API。
    *   **数据模型**：用户表、角色表、权限点表、组织架构表、用户-角色关联表、角色-权限关联表。

2.  **2.2 通知模块**
    *   **功能**：统一消息通道管理（站内信、短信、邮件、钉钉/企微、App推送）、消息模板、发送记录、订阅规则。
    *   **接口**：提供“发送消息”API，各中台调用。

3.  **2.3 授权与许可模块**
    *   **功能**：控制整个平台及各中台的功能模块、设备点数、AI算法调用次数、用户并发数等许可。支持License文件或在线激活。

---

#### **第三部分：各中台详细功能设计**

**3.1 物联中台**
*   **定位**：所有物联网设备和数据的接入、管理和预处理中心。
*   **核心模块**：
    *   **3.1.1 平台首页看板**：全局设备状态、数据上报量、报警统计、关键指标。
    *   **3.1.2 模型管理**：定义设备物模型（属性、服务、事件），支持标准物模型（如阿里云ICA）。
    *   **3.1.3 设备管理**：设备生命周期管理（注册、激活、禁用、删除）、设备分组、设备影子、远程配置与诊断。
    *   **3.1.4 驱动管理**：协议驱动（Modbus, OPC UA, MQTT等）的容器化部署、配置、监控与热更新。
    *   **3.1.5 报警管理**：基于规则的报警引擎（阈值、突变、复合条件）、报警分级、报警处理工作流、报警历史。
    *   **3.1.6 物联数据分析**：实时数据流计算（窗口、聚合）、时序数据存储与查询、简单数据预处理。
    *   **3.1.7 日志分析**：设备上下线日志、指令下发日志、通信日志的采集、检索与分析。

**3.2 业务中台**
*   **定位**：封装核心业务流程、逻辑和数据，为上层应用提供可复用的业务服务。
*   **核心模块**：
    *   **3.2.1 看板**：关键业务指标（KPI）仪表盘，如能耗、产量、效率等。
    *   **3.2.2 数据管理**：业务主数据、字典数据、业务流程配置数据的管理。
    *   **3.2.3 数据分析**：基于物联数据的业务分析（报表、趋势、对比）。
    *   **3.2.4 媒体库**：与非视频类业务相关的文件（如图片、文档）的统一存储与管理。
    *   **3.2.5 业务流程**：可视化流程设计器（BPMN）、工单流转、审批流。
    *   **3.2.6 报表管理**：自定义报表设计、定时生成、导出。

**3.3 视频中台**
*   **定位**：视频流媒体处理与分析的中心。
*   **核心模块**：
    *   **3.3.1 看板**：视频在线状态、AI分析任务状态、存储空间概览。
    *   **3.3.2 国标视频**：支持GB/T28181协议，实现设备注册、目录同步、实时预览、云台控制、录像回放与下载。
    *   **3.3.3 视频流**：RTSP/RTMP/FLV/HLS流媒体转发、转码、录制、直播与点播服务。
    *   **3.3.4 视频算法**：算法仓库管理、算法容器化部署、视频分析任务编排与调度、分析结果输出。
    *   **3.3.5 视频设备管理**：网络摄像机、NVR/DVR等视频硬件的管理与状态监控。

**3.4 可视化中台**
*   **定位**：零代码/低代码构建2D/3D数据可视化应用和大屏。
*   **核心模块**：
    *   **3.4.1 前台项目管理**：可视化应用/大屏项目的创建、分类、发布、访问权限控制。
    *   **3.4.2 编辑器**：
        *   **画布**：拖拽式布局，支持图层、组合、对齐。
        *   **组件库**：丰富的图表、地图、控件、3D模型、SVG图标。
        *   **数据绑定**：配置组件与各中台数据源的连接（API、WebSocket、数据库）。
        *   **交互配置**：定义组件间的联动、事件触发动作。
        *   **样式配置**：全面控制组件样式和动画效果。

**3.5 AI中台**
*   **定位**：AI能力工厂，提供从算法到智能体的全生命周期管理。
*   **核心模块**：
    *   **3.5.1 平台AI Agent管理**：
        *   **Agent仓库**：预置和自定义智能体（如巡检Agent、问答Agent）。
        *   **Agent编排**：通过工作流组合工具调用、知识库检索、条件判断等能力。
        *   **Agent运行与监控**：Agent实例的启动、对话历史、性能监控。
    *   **3.5.2 AI算法中心**：
        *   **算法市场**：集成多种AI算法（CV、NLP、预测）。
        *   **模型管理**：模型版本、评估、部署、服务化。
        *   **知识库管理**：对接向量数据库，管理文档知识，供Agent检索增强。

---

#### **第四部分：中台集成与接口规范**

1.  **4.1 中台间数据流**
    *   **物联 -> 业务/AI/可视化**：设备实时数据、报警事件。
    *   **视频 -> AI**：视频流，用于智能分析。
    *   **AI -> 业务/可视化**：分析结果、预警信息、Agent输出。
    *   **业务 -> 可视化**：业务数据、报表数据。

2.  **4.2 核心API清单（为每个中台定义）**
    *   **格式**：采用RESTful API，统一使用JSON。
    *   **安全**：通过**统一认证授权中心**进行JWT令牌校验。
    *   **示例**：
        *   `物联中台-设备API`：`GET /api/v1/iot/devices` 获取设备列表。
        *   `视频中台-视频流API`：`GET /api/v1/video/live/{deviceId}/flv` 获取FLV直播流。
        *   `业务中台-数据API`：`POST /api/v1/biz/data/query` 查询业务数据。

3.  **4.3 消息中间件集成**
    *   **技术选型**：Apache Kafka / RabbitMQ / Pulsar。
    *   **用途**：用于中台间异步事件通信（如设备报警事件广播）。

---

#### **第五部分：非功能性需求**

1.  **5.1 性能**：支持万级设备并发接入，关键API响应时间<1秒。
2.  **5.2 可靠性**：核心中台服务可用性>99.9%，支持集群部署。
3.  **5.3 安全性**：全链路HTTPS，数据加密存储，API防攻击，操作日志审计。
4.  **5.4 可维护性**：提供完善的日志、监控、告警体系（基于Prometheus+Grafana等）。

---

#### **第六部分：部署架构**

1.  **6.1 部署模式**
    *   **模式一（全集成）**：所有中台部署在同一集群，共享数据库和中间件（不同Schema）。
    *   **模式二（部分独立）**：物联、视频等高负载中台独立部署，业务、可视化、AI中台集成部署。
    *   **模式三（完全独立）**：每个中台均为独立集群，通过API网关和消息队列互联。

2.  **6.2 技术栈建议（供AI生成时参考）**
    *   **后端**：Java (Spring Cloud) / Go (微服务框架)。
    *   **前端**：Vue 3 / React。
    *   **数据库**：PostgreSQL (业务数据)， TDengine/InfluxDB (时序数据)， Redis (缓存)。
    *   **容器**：Docker, Kubernetes。

